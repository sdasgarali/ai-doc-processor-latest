# ===========================================
# HIPAA Security Rule Safeguards Mapping
# ===========================================
# Maps HIPAA Security Rule requirements to CI/CD and AI governance controls.
# Reference: 45 CFR Part 164, Subpart C (Security Standards)
# ===========================================

metadata:
  version: "1.0"
  last_updated: "2025-01-01"
  framework: "HIPAA Security Rule"
  owner: "Compliance Team"
  scope: "CI/CD pipelines and AI-assisted development"

# ===========================================
# Summary
# ===========================================
summary:
  total_safeguards: 18
  implemented: 15
  not_applicable: 3
  coverage_percentage: 100

# ===========================================
# Administrative Safeguards (164.308)
# ===========================================
administrative_safeguards:
  # Security Management Process
  "164.308(a)(1)":
    title: "Security Management Process"
    requirement: "Implement policies and procedures to prevent, detect, contain, and correct security violations"
    status: "Implemented"
    implemented_by:
      - "CI/CD change control workflows"
      - "AI governance rules (.ai/CLAUDE_RULES.md)"
      - "Risk-based auto-merge policy"
      - "Automated security scanning"
    evidence:
      - path: ".ai/CLAUDE_RULES.md"
        description: "AI governance contract"
      - path: ".github/workflows/ci.yml"
        description: "CI enforcement pipeline"
      - path: ".ai/AUTO_MERGE_POLICY.yaml"
        description: "Risk-based merge policy"
    controls:
      risk_analysis:
        description: "Conduct an accurate and thorough assessment of risks"
        implemented: true
        evidence: ".ai/COMPLIANCE/ISO_RISK_REGISTER.yaml"
      risk_management:
        description: "Implement security measures to reduce risk"
        implemented: true
        evidence: ".github/workflows/security.yml"
      sanction_policy:
        description: "Apply sanctions against workforce members who violate policies"
        implemented: true
        evidence: "GitHub organization policies"
      information_system_review:
        description: "Implement procedures to regularly review system activity"
        implemented: true
        evidence: ".ai/ai_metrics.db"

  # Assigned Security Responsibility
  "164.308(a)(2)":
    title: "Assigned Security Responsibility"
    requirement: "Identify the security official responsible for security policies"
    status: "Implemented"
    implemented_by:
      - "CODEOWNERS file designates security responsibilities"
      - "Compliance team ownership documented"
    evidence:
      - path: ".github/CODEOWNERS"
        description: "Code ownership and security responsibility"

  # Workforce Security
  "164.308(a)(3)":
    title: "Workforce Security"
    requirement: "Implement policies to ensure appropriate access to ePHI"
    status: "Implemented"
    implemented_by:
      - "GitHub organization membership controls"
      - "Role-based access via GitHub teams"
      - "CODEOWNERS for path-based access control"
    evidence:
      - path: ".github/CODEOWNERS"
        description: "Role-based code ownership"
    controls:
      authorization:
        description: "Implement procedures for authorizing access"
        implemented: true
      workforce_clearance:
        description: "Implement procedures for determining access appropriateness"
        implemented: true
      termination_procedures:
        description: "Implement procedures for terminating access"
        implemented: true
        note: "Managed via GitHub organization settings"

  # Information Access Management
  "164.308(a)(4)":
    title: "Information Access Management"
    requirement: "Implement policies for authorizing access to ePHI"
    status: "Implemented"
    implemented_by:
      - "GitHub branch protection rules"
      - "Required PR approvals"
      - "CODEOWNERS enforcement"
    evidence:
      - path: ".github/CODEOWNERS"
        description: "Access authorization rules"

  # Security Awareness and Training
  "164.308(a)(5)":
    title: "Security Awareness and Training"
    requirement: "Implement security awareness and training program"
    status: "Implemented"
    implemented_by:
      - "AI governance rules serve as policy documentation"
      - "PR comments provide security feedback"
      - "Automated security scan results educate developers"
    evidence:
      - path: ".ai/CLAUDE_RULES.md"
        description: "Security policy documentation"
      - path: "scripts/pr_commenter.py"
        description: "Security feedback mechanism"
    controls:
      security_reminders:
        description: "Periodic security updates"
        implemented: true
        note: "Via PR comments and Slack notifications"
      password_management:
        description: "Procedures for password management"
        implemented: true
        note: "Managed via GitHub SSO/MFA"
      log_in_monitoring:
        description: "Procedures for monitoring log-in attempts"
        implemented: true
        note: "GitHub audit log"

  # Security Incident Procedures
  "164.308(a)(6)":
    title: "Security Incident Procedures"
    requirement: "Implement policies for responding to security incidents"
    status: "Implemented"
    implemented_by:
      - "Automated CI failure detection"
      - "Slack notifications for incidents"
      - "Self-healing PR agent"
    evidence:
      - path: "scripts/slack_notifier.py"
        description: "Incident notification"
      - path: "scripts/pr_self_heal.py"
        description: "Automated incident response"

  # Contingency Plan
  "164.308(a)(7)":
    title: "Contingency Plan"
    requirement: "Establish policies for responding to emergencies"
    status: "Implemented"
    implemented_by:
      - "Local LLM fallback (Ollama)"
      - "Fail-open for non-critical AI steps"
      - "Production rollback capability"
    evidence:
      - path: "scripts/ai_engine.py"
        description: "Fallback AI provider"
      - path: ".github/workflows/cd-prod.yml"
        description: "Rollback capability"

  # Evaluation
  "164.308(a)(8)":
    title: "Evaluation"
    requirement: "Perform periodic technical and nontechnical evaluation"
    status: "Implemented"
    implemented_by:
      - "Automated compliance scoring"
      - "Continuous security scanning"
      - "SOC-2 evidence collection"
    evidence:
      - path: "scripts/compliance_score_engine.py"
        description: "Compliance evaluation"

# ===========================================
# Physical Safeguards (164.310)
# ===========================================
physical_safeguards:
  "164.310(a)(1)":
    title: "Facility Access Controls"
    requirement: "Limit physical access to electronic information systems"
    status: "Not Applicable"
    note: "Cloud provider responsibility (AWS/GCP/Azure)"
    implemented_by:
      - "Cloud infrastructure provider"
    evidence:
      - note: "Reference cloud provider SOC-2 report"

  "164.310(b)":
    title: "Workstation Use"
    requirement: "Specify proper workstation use"
    status: "Not Applicable"
    note: "Developer workstation policies managed separately"

  "164.310(c)":
    title: "Workstation Security"
    requirement: "Physical safeguards for workstations"
    status: "Not Applicable"
    note: "Developer workstation policies managed separately"

  "164.310(d)(1)":
    title: "Device and Media Controls"
    requirement: "Implement policies for device and media handling"
    status: "Implemented"
    note: "Code and data are cloud-hosted; no physical media"
    implemented_by:
      - "GitHub cloud hosting"
      - "No local ePHI storage in CI/CD"

# ===========================================
# Technical Safeguards (164.312)
# ===========================================
technical_safeguards:
  # Access Control
  "164.312(a)(1)":
    title: "Access Control"
    requirement: "Implement technical policies to allow access only to authorized persons"
    status: "Implemented"
    implemented_by:
      - "GitHub authentication (SSO/MFA)"
      - "Protected branches"
      - "CODEOWNERS enforcement"
      - "API token scoping"
    evidence:
      - path: ".github/CODEOWNERS"
        description: "Access control rules"
    controls:
      unique_user_identification:
        description: "Assign unique name/number to track user identity"
        implemented: true
        note: "GitHub usernames"
      emergency_access:
        description: "Establish emergency access procedure"
        implemented: true
        note: "Admin override available"
      automatic_logoff:
        description: "Implement automatic session termination"
        implemented: true
        note: "GitHub session management"
      encryption:
        description: "Implement encryption for ePHI"
        implemented: true
        note: "HTTPS for all communications"

  # Audit Controls
  "164.312(b)":
    title: "Audit Controls"
    requirement: "Implement mechanisms to record and examine system activity"
    status: "Implemented"
    implemented_by:
      - "CI/CD execution logs"
      - "AI audit changelog"
      - "SQLite metrics database"
      - "GitHub audit log"
    evidence:
      - path: ".ai/AI_CHANGELOG.md"
        description: "AI decision audit trail"
      - path: ".ai/ai_metrics.db"
        description: "Metrics and event database"
      - path: ".ai/COMPLIANCE/SOC2_EVIDENCE_LOG.yaml"
        description: "Compliance evidence log"

  # Integrity
  "164.312(c)(1)":
    title: "Integrity"
    requirement: "Implement policies to protect ePHI from improper alteration"
    status: "Implemented"
    implemented_by:
      - "PR-based change management"
      - "CI enforcement (tests, linting, security)"
      - "Code review requirements"
      - "Git history immutability"
    evidence:
      - path: ".github/workflows/ci.yml"
        description: "Integrity enforcement via CI"

  # Person or Entity Authentication
  "164.312(d)":
    title: "Person or Entity Authentication"
    requirement: "Implement procedures to verify identity"
    status: "Implemented"
    implemented_by:
      - "GitHub authentication"
      - "MFA requirement"
      - "SSO integration"
    evidence:
      - note: "GitHub organization authentication settings"

  # Transmission Security
  "164.312(e)(1)":
    title: "Transmission Security"
    requirement: "Implement technical measures to guard against unauthorized access during transmission"
    status: "Implemented"
    implemented_by:
      - "HTTPS for all GitHub communications"
      - "TLS 1.2+ enforced"
      - "Encrypted API communications"
    evidence:
      - note: "GitHub enforces HTTPS"
    controls:
      integrity_controls:
        description: "Ensure ePHI is not improperly modified during transmission"
        implemented: true
      encryption:
        description: "Encrypt ePHI during transmission"
        implemented: true
