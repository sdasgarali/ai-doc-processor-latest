# ===========================================
# Compliance Score Configuration
# ===========================================
# Defines weights and thresholds for calculating
# overall compliance health score (0-100).
# ===========================================

metadata:
  version: "1.0"
  last_updated: "2025-01-01"
  owner: "Compliance Team"

# ===========================================
# Score Components
# ===========================================
# Each component contributes to the overall score
# based on its weight (weights must sum to 100)

components:
  # SOC-2 Control Implementation
  soc2_controls:
    weight: 25
    description: "SOC-2 control implementation coverage"
    source: ".ai/COMPLIANCE/SOC2_MAPPING.yaml"
    calculation: "implemented / total_controls * 100"
    thresholds:
      excellent: 95
      good: 80
      acceptable: 60
      poor: 0

  # ISO 27001 Control Implementation
  iso27001_controls:
    weight: 20
    description: "ISO 27001 control implementation coverage"
    source: ".ai/COMPLIANCE/ISO27001_MAPPING.yaml"
    calculation: "implemented / total_controls * 100"
    thresholds:
      excellent: 95
      good: 80
      acceptable: 60
      poor: 0

  # Risk Management
  risk_management:
    weight: 20
    description: "Risk register health (mitigated vs open)"
    source: ".ai/COMPLIANCE/ISO_RISK_REGISTER.yaml"
    calculation: "(mitigated + accepted) / total_risks * 100"
    thresholds:
      excellent: 90
      good: 75
      acceptable: 50
      poor: 0

  # Evidence Collection
  evidence_collection:
    weight: 15
    description: "Type II evidence sufficiency"
    source: ".ai/COMPLIANCE/SOC2_EVIDENCE_LOG.yaml"
    calculation: "entries / target_entries * 100 (capped at 100)"
    target_entries: 200  # Minimum for audit readiness
    thresholds:
      excellent: 100
      good: 75
      acceptable: 50
      poor: 0

  # CI/CD Compliance
  cicd_compliance:
    weight: 10
    description: "CI/CD pipeline compliance checks"
    checks:
      - name: "Branch protection enabled"
        file: ".github/CODEOWNERS"
        required: true
      - name: "CI workflow exists"
        file: ".github/workflows/ci.yml"
        required: true
      - name: "Security workflow exists"
        file: ".github/workflows/security.yml"
        required: true
      - name: "AI review workflow exists"
        file: ".github/workflows/ai-review.yml"
        required: true
      - name: "Auto-merge policy defined"
        file: ".ai/AUTO_MERGE_POLICY.yaml"
        required: true
    thresholds:
      excellent: 100
      good: 80
      acceptable: 60
      poor: 0

  # Questionnaire Readiness
  questionnaire_readiness:
    weight: 10
    description: "Security questionnaire answer coverage"
    sources:
      - ".ai/COMPLIANCE/QUESTIONNAIRES/SIG.yaml"
      - ".ai/COMPLIANCE/QUESTIONNAIRES/CAIQ.yaml"
    calculation: "implemented_answers / total_questions * 100"
    thresholds:
      excellent: 95
      good: 80
      acceptable: 60
      poor: 0

# ===========================================
# Overall Score Thresholds
# ===========================================
# Interpretation of the final weighted score

overall_thresholds:
  excellent:
    min_score: 90
    label: "Excellent"
    color: "#22c55e"  # green
    description: "Audit-ready with minimal gaps"

  good:
    min_score: 75
    label: "Good"
    color: "#3b82f6"  # blue
    description: "Strong compliance posture with minor improvements needed"

  acceptable:
    min_score: 60
    label: "Acceptable"
    color: "#f59e0b"  # amber
    description: "Basic compliance met, significant improvements recommended"

  needs_attention:
    min_score: 40
    label: "Needs Attention"
    color: "#f97316"  # orange
    description: "Compliance gaps require immediate attention"

  critical:
    min_score: 0
    label: "Critical"
    color: "#ef4444"  # red
    description: "Major compliance failures, not audit-ready"

# ===========================================
# Reporting Configuration
# ===========================================

reporting:
  # How often to recalculate score
  refresh_interval: "per_commit"

  # Where to output score
  outputs:
    - type: "json"
      path: "reports/compliance_score.json"
    - type: "badge"
      path: "reports/compliance_badge.svg"
    - type: "dashboard"
      endpoint: "trust-portal/data.json"

  # Score history retention
  history:
    enabled: true
    retention_days: 365
    storage: ".ai/COMPLIANCE/score_history.yaml"

  # Alerting thresholds
  alerts:
    score_drop:
      threshold: 10  # Alert if score drops by 10+ points
      channel: "slack"
    critical_score:
      threshold: 40  # Alert if score drops below 40
      channel: "slack"

# ===========================================
# Audit Period Configuration
# ===========================================

audit_period:
  type: "rolling"
  duration_days: 365
  start_date: "2025-01-01"
  evidence_target:
    per_control: 50
    total: 200
