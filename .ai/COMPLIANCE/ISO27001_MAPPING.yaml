# ===========================================
# ISO 27001:2022 Annex A Control Mapping
# ===========================================
# Maps CI/CD and AI governance controls to ISO 27001 Annex A.
# Used for audit evidence and compliance reporting.
# ===========================================

framework: ISO27001
version: "2022"
last_reviewed: "2024-01-01"
owner: "Security Team"

annex_a:
  # ===========================================
  # A.5 - Organizational Controls
  # ===========================================
  A.5:
    A.5.1:
      description: "Policies for information security"
      control_objective: "Information security policy and topic-specific policies"
      implemented_by:
        - AI governance rules document
        - Auto-merge policy
        - Bootstrap prompt for AI sessions
      evidence:
        - .ai/CLAUDE_RULES.md
        - .ai/AUTO_MERGE_POLICY.yaml
        - .ai/BOOTSTRAP_PROMPT.md
      test_procedure: |
        1. Verify CLAUDE_RULES.md exists and is version-controlled
        2. Confirm policy is enforced via automation
        3. Check policy is reviewed periodically
      status: implemented

    A.5.8:
      description: "Information security in project management"
      control_objective: "Security is integrated into project management"
      implemented_by:
        - Security scanning in CI pipeline
        - AI security review on PRs
        - Risk classification for changes
      evidence:
        - .github/workflows/security.yml
        - .github/workflows/ai-review.yml
        - scripts/ai_rules_audit.py
      test_procedure: |
        1. Verify security scans run on all PRs
        2. Confirm risk assessment is performed
      status: implemented

    A.5.15:
      description: "Access control"
      control_objective: "Access to information and systems is restricted"
      implemented_by:
        - GitHub authentication
        - CODEOWNERS access control
        - Branch protection rules
      evidence:
        - .github/CODEOWNERS
      test_procedure: |
        1. Verify CODEOWNERS covers sensitive paths
        2. Confirm branch protection is enabled
      status: implemented

  # ===========================================
  # A.8 - Technological Controls
  # ===========================================
  A.8:
    A.8.4:
      description: "Access to source code"
      control_objective: "Access to source code is restricted and managed"
      implemented_by:
        - GitHub repository access controls
        - CODEOWNERS for sensitive files
        - PR approval requirements
      evidence:
        - .github/CODEOWNERS
        - Branch protection settings
      test_procedure: |
        1. Verify repository visibility settings
        2. Confirm code access audit trail exists
      status: implemented

    A.8.8:
      description: "Management of technical vulnerabilities"
      control_objective: "Technical vulnerabilities are identified and addressed"
      implemented_by:
        - Bandit security scanner
        - pip-audit dependency checks
        - Safety vulnerability database
        - Weekly scheduled security scans
      evidence:
        - .github/workflows/security.yml
      test_procedure: |
        1. Verify security scans detect known vulnerabilities
        2. Confirm scan results are reviewed
        3. Check remediation process exists
      status: implemented

    A.8.9:
      description: "Configuration management"
      control_objective: "Configurations are established and maintained"
      implemented_by:
        - Version-controlled CI/CD pipelines
        - Infrastructure as Code
        - pyproject.toml for project config
        - Pre-commit hooks configuration
      evidence:
        - .github/workflows/
        - pyproject.toml
        - .pre-commit-config.yaml
      test_procedure: |
        1. Verify all config is version-controlled
        2. Confirm config changes go through PR
        3. Check config drift detection
      status: implemented

    A.8.25:
      description: "Secure development lifecycle"
      control_objective: "Security is applied throughout the development lifecycle"
      implemented_by:
        - Pre-commit security hooks
        - CI security gates
        - AI security review
        - Code review requirements
      evidence:
        - .pre-commit-config.yaml
        - .github/workflows/ci.yml
        - .github/workflows/ai-review.yml
      test_procedure: |
        1. Verify pre-commit hooks include security checks
        2. Confirm CI fails on security issues
        3. Check security review in AI prompts
      status: implemented

    A.8.26:
      description: "Application security requirements"
      control_objective: "Security requirements are identified and implemented"
      implemented_by:
        - AI governance rules (security section)
        - Security scanning workflows
        - Coverage requirements (>=85%)
      evidence:
        - .ai/CLAUDE_RULES.md
        - .github/workflows/security.yml
        - pyproject.toml
      test_procedure: |
        1. Verify security requirements documented
        2. Confirm requirements are enforced
      status: implemented

    A.8.27:
      description: "Secure system architecture"
      control_objective: "Systems are designed with security principles"
      implemented_by:
        - AI provider abstraction (single module)
        - Fail-closed CI gates
        - Defense in depth (multiple checks)
      evidence:
        - scripts/ai_engine.py
        - .github/workflows/ci.yml
        - .ai/CLAUDE_RULES.md
      test_procedure: |
        1. Verify AI logic is centralized
        2. Confirm fail-closed behavior
      status: implemented

    A.8.28:
      description: "Secure coding"
      control_objective: "Secure coding principles are applied"
      implemented_by:
        - Ruff linting with security rules
        - Bandit static analysis
        - AI code review for security
        - Pre-commit hooks
      evidence:
        - pyproject.toml
        - .pre-commit-config.yaml
        - .github/workflows/security.yml
      test_procedure: |
        1. Verify linting includes security rules
        2. Confirm static analysis runs
      status: implemented

    A.8.29:
      description: "Security testing in development"
      control_objective: "Security testing is conducted during development"
      implemented_by:
        - Automated security scans on PRs
        - Bandit/Safety/pip-audit checks
        - AI security review
      evidence:
        - .github/workflows/security.yml
        - .github/workflows/ai-review.yml
      test_procedure: |
        1. Verify security tests run on each PR
        2. Confirm test failures block merge
      status: implemented

    A.8.31:
      description: "Separation of development environments"
      control_objective: "Development, testing, and production are separated"
      implemented_by:
        - Staging deployment workflow
        - Production deployment with gates
        - Environment-specific configurations
      evidence:
        - .github/workflows/cd-staging.yml
        - .github/workflows/cd-prod.yml
      test_procedure: |
        1. Verify separate deployment workflows
        2. Confirm production requires additional approval
      status: implemented

    A.8.32:
      description: "Change management"
      control_objective: "Changes are controlled throughout the lifecycle"
      implemented_by:
        - PR-based change workflow
        - CI/CD pipelines
        - AI governance enforcement
        - Audit trail (AI_CHANGELOG.md)
      evidence:
        - .ai/CLAUDE_RULES.md
        - .ai/AI_CHANGELOG.md
        - .github/workflows/ci.yml
      test_procedure: |
        1. Verify all changes go through PR
        2. Confirm audit trail is maintained
      status: implemented

  # ===========================================
  # A.16 - Information Security Incident Management
  # ===========================================
  A.16:
    A.16.1:
      description: "Management of information security incidents"
      control_objective: "Incidents are managed effectively"
      implemented_by:
        - CI failure alerts
        - Self-healing PR agent
        - Slack notifications
        - PR commenting for incident trail
      evidence:
        - scripts/pr_self_heal.py
        - scripts/slack_notifier.py
        - scripts/pr_commenter.py
      test_procedure: |
        1. Verify incident notifications work
        2. Confirm incident response is documented
        3. Check self-healing agent logs
      status: implemented

# ===========================================
# Compliance Summary
# ===========================================
summary:
  total_controls: 15
  implemented: 15
  partially_implemented: 0
  not_implemented: 0
  coverage_percentage: 100

# ===========================================
# Audit Notes
# ===========================================
audit_notes:
  - Controls are mapped to 2022 version of ISO 27001
  - Evidence is machine-readable and exportable
  - Run scripts/export_compliance_evidence.py for full package
